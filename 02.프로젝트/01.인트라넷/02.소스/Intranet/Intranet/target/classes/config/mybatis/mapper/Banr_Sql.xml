<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="banr">
	<select id="intrBanrInqy1010" resultType="CamelHashMap" parameterType="java.util.HashMap">
		/* intrBanrInqy1010 : 배너 시퀀스 조회 */
		SELECT 'BANR_' || LPAD(NVL(MAX(REPLACE(BANR_CD,'BANR_')),0) + 1,4,0) AS SEQUENCE_ID FROM BANR
	</select>
	
	<select id="intrBanrInqy1011" resultType="CamelHashMap" parameterType="java.util.HashMap">
		/* intrBanrInqy1011 : 배너 조회 */
		SELECT
				B.BANR_CD
			,	B.BANR_SDT
			,	B.BANR_EDT
			,	B.BANR_IDX
			,	B.WIDTH
			,	B.HEIGHT
			,	B.BANR_URL
			,	B.USE_YN
			,	F.FILE_ID
			,	F.FILE_SNO
			,	F.FILE_NM
			,	F.FILETYPE_CD
			,	F.FILE_PATH
			,	F.FILE_EXT
			,	F.FILE_SIZE
		FROM BANR B
		INNER JOIN FILE_INFO F
			ON B.BANR_CD = F.FILE_ID
		INNER JOIN EMP_INFO E
			ON B.BANR_IDX = E.EMP_IDX
		INNER JOIN ORG O
			ON O.ORG_CD = E.ORG_CD
		WHERE F.FILETYPE_CD = 'BANR'
			AND F.USE_YN = 'Y'
	</select>
	
	<insert id="intrBanrProc1011" parameterType="java.util.HashMap">
		/* intrBanrProc1011 : 배너 등록 처리 */
		MERGE INTO BANR B
		USING (
			SELECT
						#{banrCd, jdbcType=VARCHAR} AS BANR_CD
					,	#{banrSdt, jdbcType=VARCHAR} AS BANR_SDT
					,	#{banrEdt, jdbcType=VARCHAR} AS BANR_EDT
					,	#{banrIdx, jdbcType=VARCHAR} AS BANR_IDX
					,	#{width, jdbcType=VARCHAR} AS WIDTH
					,	#{height, jdbcType=VARCHAR} AS HEIGHT
					,	#{banrUrl, jdbcType=VARCHAR} AS BANR_URL
			FROM DUAL
		) D
		ON (B.BANR_CD = D.BANR_CD)
		WHEN MATCHED THEN
			UPDATE BANR
				SET BANR_SDT = #{banrSdt, jdbcType=VARCHAR}
					,	BANR_EDT = #{banrEdt, jdbcType=VARCHAR}
					,	BANR_IDX = #{banrIdx, jdbcType=VARCHAR}
					,	WIDTH = #{width, jdbcType=VARCHAR}
					,	HEIGHT = #{height, jdbcType=VARCHAR}
					,	BANR_URL = #{banrUrl, jdbcType=VARCHAR}
		WHEN NOT MATCHED THEN
			INSERT INTO BANR
			(
				BANR_CD
			,	BANR_SDT
			,	BANR_EDT
			,	BANR_IDX
			,	WIDTH
			,	HEIGHT
			,	BANR_URL
			,	REG_DT
			,	REG_TM
			,	USE_YN
			,	DISP_ORDER
			,	REMARK
		)
		VALUES
		(
				#{sequenceId, jdbcType=VARCHAR}
			,	#{banrSdt, jdbcType=VARCHAR}
			,	#{banrEdt, jdbcType=VARCHAR}
			,	#{banrIdx, jdbcType=VARCHAR}
			,	#{width, jdbcType=VARCHAR}
			,	#{height, jdbcType=VARCHAR}
			,	#{banrUrl, jdbcType=VARCHAR}
			,	TO_CHAR(SYSDATE,'YYYYMMDD')
			,	TO_CHAR(SYSDATE,'HH24MISS')
			,	#{useYn, jdbcType=VARCHAR}
			,	(
					SELECT 
						NVL(MAX(DISP_ORDER),0) + 1 
					FROM BANR
				)
			,	NULL
			)
	</insert>
	
	<update id="intrBanrProc1021" parameterType="java.util.HashMap">
		/* intrBanrProc1021 : 배너 삭제 처리 (수정)  */
		UPDATE BANR
			SET USE_YN = 'N'
		WHERE 1=1
	</update>
</mapper>